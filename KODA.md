# Air Task CLI - Руководство по проекту

## Обзор проекта

**Air Task CLI** — это интерактивное консольное приложение для управления задачами и отслеживания времени, разработанное на фреймворке Micronaut 4.10.7 с использованием Java 21. Приложение предоставляет удобный CLI-интерфейс для работы с системой управления проектами и задачами через терминал.

### Основное назначение
- Интерактивное управление проектами и задачами
- Трекинг времени работы над задачами
- Интеграция с REST API системы управления задачами
- Удобный табличный вывод информации в терминале

## Технологический стек

### Основные технологии
- **Java 21** — современная версия языка программирования
- **Micronaut 4.10.7** — современный микросервисный фреймворк
- **Picocli 4.7.6** — библиотека для создания CLI-приложений
- **JLine 3** — библиотека для работы с терминалом
- **Maven** — система сборки проекта

### Ключевые зависимости
- **Micronaut HTTP Client** — для взаимодействия с REST API
- **Micronaut Serialization Jackson** — для сериализации/десериализации JSON
- **Micronaut Security** — для обеспечения безопасности
- **Micronaut OpenAPI** — для генерации API клиентов
- **Lombok** — для упрощения кода
- **Logback** — система логирования
- **AsciiTable** — для форматированного вывода таблиц в терминале
- **JUnit 5** — для тестирования

## Архитектура проекта

### Структура пакетов
```
org.cowary/
├── AirTaskCliCommand.java          # Главный класс приложения
├── command/                        # CLI команды
│   ├── AirCommands.java            # Основная команда
│   ├── TimerCommand.java           # Команда таймера (версия 1)
│   └── Timer2Command.java          # Команда таймера (версия 2)
├── service/                        # Бизнес-логика
│   └── TimerService.java           # Сервис для работы с таймером
├── config/                         # Конфигурация
│   └── BeanConfig.java            # Конфигурация бинов
└── air_task_cli/                  # Сгенерированные API модели
    ├── api/                        # API интерфейсы
    └── model/                      # Модели данных
```

### Основные компоненты

#### 1. AirTaskCliCommand
Главный класс приложения, который:
- Инициализирует контекст Micronaut
- Настраивает интерактивный терминал с JLine
- Обрабатывает пользовательский ввод
- Управляет циклом выполнения команд

#### 2. TimerService
Сервисный слой, обеспечивающий:
- Получение списка проектов через ProjectControllerApi
- Получение задач по проекту через TaskControllerApi
- Обновление времени задач через API
- Запуск таймера обратного отсчета

#### 3. CLI Команды
- **AirCommands** — корневая команда с подкомандами
- **TimerCommand** — интерактивный таймер с выбором проекта и задачи
- **Timer2Command** — улучшенная версия таймера с лучшим UI

## Сборка и запуск

### Предварительные требования
- Java 21 или выше
- Maven 3.6+

### Команды сборки
```bash
# Сборка проекта
./mvnw clean compile

# Сборка исполняемого JAR
./mvnw package

# Запуск тестов
./mvnw test

# Сборка с генерацией API клиентов
./mvnw generate-sources
```

### Команды запуска
```bash
# Запуск приложения
java -jar target/air-task-cli-0.1.jar

# Или через Maven
./mvnw exec:java

# Интерактивный режим
./mvnw micronaut:run
```

### Доступные команды в CLI
```
air-task-cli> air-task --help
air-task-cli> air-task timer
air-task-cli> air-task timer2
air-task-cli> help
air-task-cli> exit
```

## Конфигурация

### application.properties
```properties
micronaut.application.name=air-task-cli
openapi-micronaut-client-base-path=http://localhost:8090
```

### logback.xml
Настроен вывод логов в консоль с цветовым форматированием:
- Уровень логирования: INFO
- Формат: время [поток] уровень логгер - сообщение
- Цветовая схема для различных уровней логирования

### OpenAPI интеграция
Приложение использует OpenAPI спецификацию (`src/main/resources/openapi/air-task-cli.json`) для:
- Генерации HTTP клиентов
- Создания моделей данных
- Документирования API

## API Интеграция

### Базовый URL
- По умолчанию: `http://localhost:8090`
- Может быть изменен через конфигурацию

### Основные эндпоинты
1. **GET /v1/list** — получение списка проектов
2. **GET /v1/list-by-project/{projectId}** — получение задач проекта
3. **POST /v1/update-time** — обновление времени задачи

### Модели данных
- **ProjectListDtoRs** — список проектов
- **BoardRs** — доска с задачами
- **TaskListRs** — список задач
- **TaskDtoRs** — отдельная задача

## Особенности реализации

### Интерактивный интерфейс
- Использование JLine для терминального ввода
- Поддержка истории команд
- Цветной вывод таблиц с помощью AsciiTable
- Обработка прерываний (Ctrl+C)

### Таймер функциональность
- Интерактивный выбор проекта и задачи
- Запуск таймера обратного отсчета
- Отправка времени на сервер после завершения
- Звуковое уведомление при завершении

### Обработка ошибок
- Graceful обработка исключений
- Логирование ошибок с помощью SLF4J
- Пользовательские сообщения об ошибках
- Валидация пользовательского ввода

## Правила разработки

### Стиль кодирования
- Использование Lombok для сокращения boilerplate кода
- Аннотации Jakarta для dependency injection
- Записи (records) для простых DTO
- Соглашения по именованию Java

### Тестирование
- JUnit 5 для модульного тестирования
- Micronaut Test для интеграционного тестирования
- Тестирование CLI команд через PicocliRunner

### Структура коммитов
- Следование стандартным практикам Git
- Описательные сообщения коммитов
- Разделение функциональности на атомарные коммиты

## Развертывание

### Требования к окружению
- JVM 21+
- Доступ к API серверу (по умолчанию localhost:8090)
- Терминал с поддержкой ANSI цветов

### Создание дистрибутива
```bash
# Создание исполняемого JAR с зависимостями
./mvnw package -Dpackaging=uber-jar

# Или использование Maven Shade plugin
./mvnw package
```

### Настройка окружения
1. Установить переменную окружения для API URL (опционально)
2. Убедиться в доступности API сервера
3. Проверить настройки логирования при необходимости

## Возможные улучшения

### Функциональность
- Добавление сохранения настроек пользователя
- История выполненных таймеров
- Экспорт отчетов в различных форматах
- Поддержка множественных проектов

### Технические улучшения
- Кэширование данных проектов
- Асинхронные операции
- Конфигурация через командную строку
- Поддержка различных форматов вывода

### Пользовательский опыт
- Автодополнение команд
- Горячие клавиши
- Темная/светлая тема терминала
- Прогресс-бары для длительных операций

## Поддержка и разработка

### Документация
- Micronaut Documentation: https://docs.micronaut.io/4.10.7/
- Picocli Documentation: https://picocli.info/
- OpenAPI Generator: https://openapi-generator.tech/

### Отладка
- Использование логгера SLF4J
- Отладка через IDE
- Тестирование API через Postman/curl

### Вклад в проект
1. Fork репозитория
2. Создать ветку для новой функциональности
3. Внести изменения с соблюдением стиля кода
4. Добавить тесты для новой функциональности
5. Создать Pull Request

## Заключение

Air Task CLI представляет собой хорошо структурированное приложение для управления задачами с современным технологическим стеком. Проект демонстрирует использование лучших практик разработки на Java с Micronaut и предоставляет удобный интерфейс для работы с системой управления проектами через командную строку.

Приложение готово к использованию и может быть легко расширено новой функциональностью благодаря модульной архитектуре и использованию стандартных технологий Java экосистемы.